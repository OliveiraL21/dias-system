<div class="flex align-item-center mt-5">
  <p-confirmDialog></p-confirmDialog>
  <p-blockUI [blocked]="loading">
    <p-progressSpinner styleClass="w-4rem h-4rem" strokeWidth="8" fill="var(--surface-ground)"
      animationDuration=".5s"></p-progressSpinner>
  </p-blockUI>

  <p-card [header]="title" class="w-11 -mt-3 p-0">
    <app-custom-form [controls]="getCustomControls()" [formButtonsVisible]="false" [form]="form"
      (BackEvent)="cancel()"></app-custom-form>

    <p-table [value]="listOfProdutos" [tableStyle]="{'min-width': '50rem', 'height': '30rem'}"
      [scrollHeight]="'calc(100vh - 15rem)'">
      <ng-template pTemplate="header">
        <tr>
          <th>Produto</th>
          <th>Quantidade</th>
          <th>Valor</th>
          <th>Ações</th>
        </tr>
      </ng-template>
      <ng-template [formGroup]="form" pTemplate="body">
        <tr *ngFor="let produto of listOfProdutos; let i = index;" formArrayName="produtos">
          <td [formGroupName]="i">
            <p-dropdown formControlName="descricao" placeholder="Selecione o produto" [options]="produtos"
              [optionLabel]="'descricao'" [optionValue]="'id'" [showClear]="true"></p-dropdown>
            <small class="p-0 mb-4 p-error block"
              *ngIf="form.get('produtos')?.get('descricao')?.hasError('required') && form.get('produtos')?.get('descricao')?.dirty"></small>
          </td>
          <td [formGroupName]="i">
            <p-inputNumber [inputId]="'quantidade'" formControlName="quantidade"></p-inputNumber>
          </td>
          <td [formGroupName]="i">
            <p-inputNumber [inputId]="'valorUnitario'" formControlName="valor"></p-inputNumber>
          </td>
          <td [formGroupName]="i">
            <p-button icon="pi pi-trash" severity="danger" [text]="true" pTooltip="Excluir Produto"
              (onClick)="removerProduto($event, i)"></p-button>
          </td>
        </tr>
      </ng-template>
    </p-table>
    <div class="w-full mt-5 flex justify-content-end">
      <p-button label="Adicionar" size="small" [severity]="'primary'" icon="pi pi-plus"
        (onClick)="adicionarProduto()"></p-button>
    </div>

    <div class="w-full flex gap-2">
      <p-button class="ml-2" label="Cancelar" severity="danger" icon="pi pi-times" iconPos="right"
        (onClick)="cancelar()"></p-button>
      <p-button label="Salvar" icon="pi pi-save" iconPos="right" (onClick)="save()"></p-button>
    </div>
  </p-card>
</div>
